import{m as N,o as d,c as i,a as e,g as k,v as B,C as S,t as r,f as y,F as U,A as V,l as _,D as v,x as h,n as I}from"./app-98bb2cad.js";const A={class:"subscription-applications-page"},R={class:"bg-card rounded-lg border border-border overflow-hidden"},z={class:"p-4 border-b border-border flex flex-wrap gap-3 items-center"},O=["disabled"],q={class:"overflow-x-auto"},G={class:"w-full text-sm text-left"},H={class:"divide-y divide-border"},J={key:0,class:"bg-card"},K={key:1,class:"bg-card"},Q={class:"px-4 py-3 font-medium text-foreground"},W={class:"px-4 py-3 text-foreground"},X={class:"px-4 py-3 text-foreground"},Y={class:"px-4 py-3"},Z={class:"px-4 py-3 text-muted-foreground"},ee={class:"px-4 py-3 text-muted-foreground"},te={class:"px-4 py-3"},se={key:0,class:"flex flex-wrap gap-2 items-center"},oe=["onUpdate:modelValue"],ne=["value"],ae=["disabled","onClick"],re=["disabled","onClick"],de={key:1,class:"text-muted-foreground"},ie={key:0,class:"flex flex-wrap items-center justify-between gap-2 border-t border-border px-4 py-3"},le={class:"text-sm text-muted-foreground"},ue={class:"flex gap-2"},ce=["disabled"],pe=["disabled"],ge={key:0,class:"mt-4 rounded-md bg-red-50 dark:bg-red-900/20 p-4"},me={class:"text-sm text-red-600 dark:text-red-400"},fe={__name:"SubscriptionApplicationsPage",setup(be){const b=_([]),g=_([]),m=_(!1),l=_(""),u=v({}),f=v({}),a=v({current_page:1,last_page:1,per_page:15,total:0}),c=v({domain:"",status:""});let w=null;function $(){clearTimeout(w),w=setTimeout(()=>{a.current_page=1,x()},300)}function C(){a.current_page=1,x()}function L(s){return{pending:"Ожидает",approved:"Одобрена",rejected:"Отклонена"}[s]??s}function P(s){return{pending:"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-300",approved:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300",rejected:"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300"}[s]??"bg-gray-100 text-gray-700"}function T(s){return s?new Date(s)<new Date:!1}async function E(){try{const{data:s}=await h.get("/admin/plans");g.value=(s==null?void 0:s.data)??[]}catch{g.value=[]}}async function x(){var s,o;m.value=!0,l.value="";try{const t=new URLSearchParams;t.set("page",String(a.current_page)),t.set("per_page",String(a.per_page)),c.domain&&t.set("domain",c.domain),c.status&&t.set("status",c.status);const{data:n}=await h.get("/admin/subscription-applications?"+t.toString());b.value=(n==null?void 0:n.data)??[],Object.assign(a,(n==null?void 0:n.meta)??{}),b.value.forEach(p=>{p.status==="pending"&&f[p.id]==null&&g.value.length&&(f[p.id]=Number(g.value[0].id))})}catch(t){b.value=[],l.value=((o=(s=t.response)==null?void 0:s.data)==null?void 0:o.message)??"Ошибка загрузки"}finally{m.value=!1}}function j(s){a.current_page=s,x()}async function F(s){var o,t,n;u[s.id]=!0,l.value="";try{const p=f[s.id]??((o=g.value[0])==null?void 0:o.id);await h.post(`/admin/subscription-applications/${s.id}/approve`,{plan_id:p?Number(p):void 0}),await x()}catch(p){l.value=((n=(t=p.response)==null?void 0:t.data)==null?void 0:n.message)??"Ошибка одобрения"}finally{u[s.id]=!1}}async function M(s){var o,t;u[s.id]=!0,l.value="";try{await h.post(`/admin/subscription-applications/${s.id}/reject`),await x()}catch(n){l.value=((t=(o=n.response)==null?void 0:o.data)==null?void 0:t.message)??"Ошибка отклонения"}finally{u[s.id]=!1}}function D(s){return s?new Date(s).toLocaleDateString("ru-RU",{day:"numeric",month:"short",year:"numeric"}):"—"}return N(()=>{E(),x()}),(s,o)=>(d(),i("div",A,[o[8]||(o[8]=e("div",{class:"mb-6 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"},[e("div",null,[e("h1",{class:"text-2xl font-bold text-foreground"},"Заявки на подписку"),e("p",{class:"text-muted-foreground mt-1"},"Список заявок с пагинацией и фильтрацией")])],-1)),e("div",R,[e("div",z,[k(e("input",{"onUpdate:modelValue":o[0]||(o[0]=t=>c.domain=t),type:"text",placeholder:"Домен",class:"rounded-md border border-input bg-background px-3 py-2 text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring w-40",onInput:$},null,544),[[B,c.domain]]),k(e("select",{"onUpdate:modelValue":o[1]||(o[1]=t=>c.status=t),class:"rounded-md border border-input bg-background px-3 py-2 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-ring",onChange:C},[...o[4]||(o[4]=[e("option",{value:""},"Все статусы",-1),e("option",{value:"pending"},"Ожидает",-1),e("option",{value:"approved"},"Одобрена",-1),e("option",{value:"rejected"},"Отклонена",-1)])],544),[[S,c.status]]),e("button",{type:"button",class:"rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90 transition-colors",disabled:m.value,onClick:C},r(m.value?"Загрузка…":"Применить"),9,O)]),e("div",q,[e("table",G,[o[7]||(o[7]=e("thead",{class:"bg-muted/50 text-muted-foreground uppercase"},[e("tr",null,[e("th",{class:"px-4 py-3 font-medium"},"Домен"),e("th",{class:"px-4 py-3 font-medium"},"Имя"),e("th",{class:"px-4 py-3 font-medium"},"Email"),e("th",{class:"px-4 py-3 font-medium"},"Статус"),e("th",{class:"px-4 py-3 font-medium"},"Истекает"),e("th",{class:"px-4 py-3 font-medium"},"Создана"),e("th",{class:"px-4 py-3 font-medium"},"Действия")])],-1)),e("tbody",H,[m.value&&!b.value.length?(d(),i("tr",J,[...o[5]||(o[5]=[e("td",{colspan:"7",class:"px-4 py-8 text-center text-muted-foreground"},"Загрузка…",-1)])])):b.value.length?y("",!0):(d(),i("tr",K,[...o[6]||(o[6]=[e("td",{colspan:"7",class:"px-4 py-8 text-center text-muted-foreground"},"Нет заявок",-1)])])),(d(!0),i(U,null,V(b.value,t=>(d(),i("tr",{key:t.id,class:"bg-card hover:bg-accent/5 transition-colors"},[e("td",Q,r(t.domain),1),e("td",W,r(t.name),1),e("td",X,r(t.email),1),e("td",Y,[e("span",{class:I(["inline-flex rounded-full px-2 py-0.5 text-xs font-medium",P(t.status)])},r(L(t.status)),3)]),e("td",Z,r(D(t.expires_at)),1),e("td",ee,r(D(t.created_at)),1),e("td",te,[t.status==="pending"&&!T(t.expires_at)?(d(),i("div",se,[g.value.length?k((d(),i("select",{key:0,"onUpdate:modelValue":n=>f[t.id]=n,class:"rounded border border-input bg-background px-2 py-1 text-xs text-foreground focus:outline-none focus:ring-1 focus:ring-ring w-28"},[(d(!0),i(U,null,V(g.value,n=>(d(),i("option",{key:n.id,value:n.id},r(n.name),9,ne))),128))],8,oe)),[[S,f[t.id]]]):y("",!0),e("button",{type:"button",class:"rounded bg-green-600 px-2 py-1 text-xs font-medium text-white hover:bg-green-700 disabled:opacity-50",disabled:u[t.id],onClick:n=>F(t)},r(u[t.id]?"…":"Одобрить"),9,ae),e("button",{type:"button",class:"rounded bg-red-600 px-2 py-1 text-xs font-medium text-white hover:bg-red-700 disabled:opacity-50",disabled:u[t.id],onClick:n=>M(t)},r(u[t.id]?"…":"Отклонить"),9,re)])):(d(),i("span",de,"—"))])]))),128))])])]),a.last_page>1?(d(),i("div",ie,[e("p",le," Показано "+r((a.current_page-1)*a.per_page+1)+"–"+r(Math.min(a.current_page*a.per_page,a.total))+" из "+r(a.total),1),e("div",ue,[e("button",{type:"button",class:"rounded-md border border-input bg-background px-3 py-1.5 text-sm text-foreground hover:bg-accent/10 disabled:opacity-50 disabled:cursor-not-allowed",disabled:a.current_page<=1||m.value,onClick:o[2]||(o[2]=t=>j(a.current_page-1))}," Назад ",8,ce),e("button",{type:"button",class:"rounded-md border border-input bg-background px-3 py-1.5 text-sm text-foreground hover:bg-accent/10 disabled:opacity-50 disabled:cursor-not-allowed",disabled:a.current_page>=a.last_page||m.value,onClick:o[3]||(o[3]=t=>j(a.current_page+1))}," Вперёд ",8,pe)])])):y("",!0)]),l.value?(d(),i("div",ge,[e("p",me,r(l.value),1)])):y("",!0)]))}};export{fe as default};
