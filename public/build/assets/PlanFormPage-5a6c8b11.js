import{b as B,u as E,e as O,E as U,m as P,r as q,o as d,c as u,a as s,j as C,k as N,t as l,w as V,g,v as h,f as p,h as L,D as j,l as v,x as y,i as A}from"./app-5cd435e6.js";const R={class:"plan-form-page"},T={class:"mb-6"},z={class:"text-2xl font-bold text-foreground"},F={class:"text-muted-foreground mt-1"},G={key:0,class:"bg-card rounded-lg border border-border p-8 text-center text-muted-foreground"},H={class:"p-6 space-y-4"},I={key:0,class:"mt-1 text-sm text-red-600 dark:text-red-400"},K={key:0,class:"mt-1 text-sm text-red-600 dark:text-red-400"},Q={class:"flex items-center gap-2"},W={key:0,class:"mt-1 text-sm text-red-600 dark:text-red-400"},X={class:"px-6 py-4 border-t border-border flex flex-wrap gap-3"},Y=["disabled"],Z=["disabled"],ee={key:2,class:"mt-4 rounded-md bg-red-50 dark:bg-red-900/20 p-4 max-w-2xl"},te={class:"text-sm text-red-600 dark:text-red-400"},se={class:"bg-card rounded-lg border border-border shadow-lg max-w-md w-full mx-4 p-6"},oe={class:"text-muted-foreground text-sm mb-4"},re={class:"flex gap-2 justify-end"},ne=["disabled"],ie={__name:"PlanFormPage",setup(ae){const f=B(),w=E(),i=O(()=>!!f.params.id),o=j({name:"",cost:0,is_active:!0,limitsJson:""}),n=j({name:"",cost:"",limits:""}),k=v(!1),b=v(!1),c=v(!1),x=v(!1),m=v("");function D(){const a=(o.limitsJson||"").trim();if(!a)return null;try{const e=JSON.parse(a);return typeof e=="object"&&e!==null?e:null}catch{return}}async function _(){var a,e;if(i.value){k.value=!0,m.value="";try{const{data:r}=await y.get(`/admin/plans/${f.params.id}`),t=r==null?void 0:r.data;t&&(o.name=t.name??"",o.cost=Number(t.cost)||0,o.is_active=!!t.is_active,o.limitsJson=t.limits&&typeof t.limits=="object"?JSON.stringify(t.limits,null,2):"")}catch(r){m.value=((e=(a=r.response)==null?void 0:a.data)==null?void 0:e.message)??"Ошибка загрузки"}finally{k.value=!1}}}function J(){n.name="",n.cost="",n.limits="",m.value=""}async function S(){var e;J();const a=D();if(o.limitsJson.trim()&&a===void 0){n.limits="Некорректный JSON";return}b.value=!0;try{const r={name:o.name.trim(),cost:o.cost,is_active:o.is_active,limits:a??void 0};i.value?(await y.put(`/admin/plans/${f.params.id}`,r),await _()):(await y.post("/admin/plans",r),w.push({name:"admin.plans"}))}catch(r){const t=(e=r.response)==null?void 0:e.data;t!=null&&t.errors&&(t.errors.name&&(n.name=Array.isArray(t.errors.name)?t.errors.name[0]:t.errors.name),t.errors.cost&&(n.cost=Array.isArray(t.errors.cost)?t.errors.cost[0]:t.errors.cost),t.errors.limits&&(n.limits=Array.isArray(t.errors.limits)?t.errors.limits[0]:t.errors.limits)),m.value=(t==null?void 0:t.message)??"Ошибка сохранения"}finally{b.value=!1}}function M(){x.value=!0}async function $(){var a,e;c.value=!0,m.value="";try{await y.delete(`/admin/plans/${f.params.id}`),x.value=!1,w.push({name:"admin.plans"})}catch(r){m.value=((e=(a=r.response)==null?void 0:a.data)==null?void 0:e.message)??"Ошибка удаления"}finally{c.value=!1}}return U(()=>f.params.id,()=>{i.value?_():(o.name="",o.cost=0,o.is_active=!0,o.limitsJson="",J())},{immediate:!1}),P(()=>{i.value&&_()}),(a,e)=>{const r=q("router-link");return d(),u("div",R,[s("div",T,[C(r,{to:{name:"admin.plans"},class:"inline-flex items-center gap-1 text-sm text-muted-foreground hover:text-foreground mb-2"},{default:N(()=>[...e[6]||(e[6]=[s("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),A(" К списку планов ",-1)])]),_:1}),s("h1",z,l(i.value?"Редактирование плана":"Создание плана"),1),s("p",F,l(i.value?"Измените данные плана":"Добавьте новый тарифный план"),1)]),k.value&&i.value?(d(),u("div",G," Загрузка… ")):(d(),u("form",{key:1,class:"bg-card rounded-lg border border-border overflow-hidden max-w-2xl",onSubmit:V(S,["prevent"])},[s("div",H,[s("div",null,[e[7]||(e[7]=s("label",{for:"plan-name",class:"block text-sm font-medium text-foreground mb-1"},"Название",-1)),g(s("input",{id:"plan-name","onUpdate:modelValue":e[0]||(e[0]=t=>o.name=t),type:"text",required:"",class:"w-full rounded-md border border-input bg-background px-3 py-2 text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring",placeholder:"например, standard"},null,512),[[h,o.name]]),n.name?(d(),u("p",I,l(n.name),1)):p("",!0)]),s("div",null,[e[8]||(e[8]=s("label",{for:"plan-cost",class:"block text-sm font-medium text-foreground mb-1"},"Стоимость",-1)),g(s("input",{id:"plan-cost","onUpdate:modelValue":e[1]||(e[1]=t=>o.cost=t),type:"number",step:"0.01",min:"0",required:"",class:"w-full rounded-md border border-input bg-background px-3 py-2 text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring",placeholder:"0"},null,512),[[h,o.cost,void 0,{number:!0}]]),n.cost?(d(),u("p",K,l(n.cost),1)):p("",!0)]),s("div",Q,[g(s("input",{id:"plan-active","onUpdate:modelValue":e[2]||(e[2]=t=>o.is_active=t),type:"checkbox",class:"rounded border-input"},null,512),[[L,o.is_active]]),e[9]||(e[9]=s("label",{for:"plan-active",class:"text-sm font-medium text-foreground"},"Активен",-1))]),s("div",null,[e[10]||(e[10]=s("label",{for:"plan-limits",class:"block text-sm font-medium text-foreground mb-1"},"Ограничения (JSON)",-1)),g(s("textarea",{id:"plan-limits","onUpdate:modelValue":e[3]||(e[3]=t=>o.limitsJson=t),rows:"4",class:"w-full rounded-md border border-input bg-background px-3 py-2 text-foreground font-mono text-sm placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring",placeholder:'{"max_users": 5, "description": "Стандартный план"}'},null,512),[[h,o.limitsJson]]),e[11]||(e[11]=s("p",{class:"mt-1 text-xs text-muted-foreground"},'Необязательно. Пример: {"max_users": 5, "description": "Описание"}',-1)),n.limits?(d(),u("p",W,l(n.limits),1)):p("",!0)])]),s("div",X,[s("button",{type:"submit",class:"rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90 disabled:opacity-50",disabled:b.value},l(b.value?"Сохранение…":i.value?"Сохранить":"Создать"),9,Y),C(r,{to:{name:"admin.plans"},class:"rounded-md border border-input bg-background px-4 py-2 text-sm text-foreground hover:bg-accent/10"},{default:N(()=>[...e[12]||(e[12]=[A(" Отмена ",-1)])]),_:1}),i.value?(d(),u("button",{key:0,type:"button",class:"ml-auto rounded-md border border-red-600 text-red-600 px-4 py-2 text-sm hover:bg-red-50 dark:hover:bg-red-900/20 disabled:opacity-50",disabled:b.value||c.value,onClick:M},l(c.value?"…":"Удалить план"),9,Z)):p("",!0)])],32)),m.value?(d(),u("div",ee,[s("p",te,l(m.value),1)])):p("",!0),x.value?(d(),u("div",{key:3,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:e[5]||(e[5]=V(t=>x.value=!1,["self"]))},[s("div",se,[e[13]||(e[13]=s("h3",{class:"text-lg font-semibold text-foreground mb-2"},"Удалить план?",-1)),s("p",oe," План «"+l(o.name)+"» будет удалён. Это действие нельзя отменить. ",1),s("div",re,[s("button",{type:"button",class:"rounded-md border border-input bg-background px-4 py-2 text-sm text-foreground hover:bg-accent/10",onClick:e[4]||(e[4]=t=>x.value=!1)}," Отмена "),s("button",{type:"button",class:"rounded-md bg-red-600 px-4 py-2 text-sm font-medium text-white hover:bg-red-700 disabled:opacity-50",disabled:c.value,onClick:$},l(c.value?"…":"Удалить"),9,ne)])])])):p("",!0)])}}};export{ie as default};
