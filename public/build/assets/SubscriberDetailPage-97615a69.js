import{b as U,e as N,E as C,r as B,o as a,c as l,a as s,j as H,k as F,t as i,n as O,w as $,g as k,v as T,h as L,f as g,l as p,D as Y,i as z,x as V}from"./app-1a5e3182.js";const A={class:"subscriber-detail-page"},I={class:"mb-6"},J={class:"text-muted-foreground mt-1"},q={key:0,class:"bg-card rounded-lg border border-border p-8 text-center text-muted-foreground"},G={key:1,class:"bg-card rounded-lg border border-border p-6"},K={class:"text-red-600 dark:text-red-400"},Q={key:2,class:"space-y-6"},W={class:"bg-card rounded-lg border border-border overflow-hidden"},X={class:"divide-y divide-border"},Z={class:"grid grid-cols-1 sm:grid-cols-3 gap-2 px-4 py-3"},ee={class:"sm:col-span-2 text-foreground font-medium"},se={class:"grid grid-cols-1 sm:grid-cols-3 gap-2 px-4 py-3"},te={class:"sm:col-span-2 text-foreground"},oe={class:"grid grid-cols-1 sm:grid-cols-3 gap-2 px-4 py-3"},re={class:"sm:col-span-2 text-foreground"},de={class:"grid grid-cols-1 sm:grid-cols-3 gap-2 px-4 py-3"},ne={class:"sm:col-span-2 text-foreground"},ie={class:"grid grid-cols-1 sm:grid-cols-3 gap-2 px-4 py-3"},ae={class:"sm:col-span-2 text-foreground"},le={class:"grid grid-cols-1 sm:grid-cols-3 gap-2 px-4 py-3"},ue={class:"sm:col-span-2"},ce={class:"grid grid-cols-1 sm:grid-cols-3 gap-2 px-4 py-3"},ge={class:"sm:col-span-2 font-mono text-sm text-foreground break-all"},pe={class:"bg-card rounded-lg border border-border overflow-hidden"},me={class:"grid grid-cols-1 sm:grid-cols-3 gap-2 items-center"},be={class:"sm:col-span-2"},fe={class:"grid grid-cols-1 sm:grid-cols-3 gap-2 items-center"},ve={class:"sm:col-span-2"},xe={class:"grid grid-cols-1 sm:grid-cols-3 gap-2 items-center"},_e={class:"sm:col-span-2 space-y-1"},ye={class:"flex items-center gap-2"},he=["disabled"],ke={key:0,class:"text-xs text-amber-600 dark:text-amber-400"},we={class:"flex flex-wrap gap-2 pt-2"},De=["disabled"],Se={key:0,class:"px-6 pb-4 space-y-1"},Ne={key:0,class:"text-sm text-red-600 dark:text-red-400"},Ce={key:1,class:"text-sm text-green-600 dark:text-green-400"},Te={key:0,class:"bg-card rounded-lg border border-border overflow-hidden"},Ve={class:"p-4 text-sm text-foreground overflow-x-auto"},je={class:"bg-card rounded-lg border border-border overflow-hidden"},Me={class:"divide-y divide-border"},Pe={class:"grid grid-cols-1 sm:grid-cols-3 gap-2 px-4 py-3"},Ee={class:"sm:col-span-2 text-foreground"},Re={class:"grid grid-cols-1 sm:grid-cols-3 gap-2 px-4 py-3"},Ue={class:"sm:col-span-2 text-foreground"},Fe={__name:"SubscriberDetailPage",setup(Be){const _=U(),o=p(null),y=p(!1),m=p(""),f=p(!1),u=p(""),c=p(""),n=Y({subscription_start:"",subscription_end:"",is_active:!0}),j=N(()=>{var e;const t=(e=o.value)==null?void 0:e.payment_data;return t&&typeof t=="object"&&Object.keys(t).length>0}),v=N(()=>{const t=n.subscription_end;if(!t||typeof t!="string")return!1;const e=new Date;e.setHours(0,0,0,0);const d=new Date(t);return isNaN(d.getTime())?!1:(d.setHours(0,0,0,0),d<e)});function h(t){if(!t)return"";const e=new Date(t);if(isNaN(e.getTime()))return"";const d=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),x=String(e.getDate()).padStart(2,"0");return`${d}-${r}-${x}`}function M(){const t=o.value;if(!t)return;n.subscription_start=h(t.subscription_start),n.subscription_end=h(t.subscription_end);const e=w(h(t.subscription_end));n.is_active=e?!1:!!t.is_active,u.value="",c.value=""}function w(t){if(!t||typeof t!="string")return!1;const e=new Date;e.setHours(0,0,0,0);const d=new Date(t);return isNaN(d.getTime())?!1:(d.setHours(0,0,0,0),d<e)}async function P(){var e,d;const t=_.params.id;if(t){y.value=!0,m.value="";try{const{data:r}=await V.get("/admin/subscribers/"+t);o.value=(r==null?void 0:r.data)??null,o.value?M():m.value="Подписчик не найден"}catch(r){o.value=null,m.value=((d=(e=r.response)==null?void 0:e.data)==null?void 0:d.message)??"Ошибка загрузки"}finally{y.value=!1}}}async function E(){var e;const t=_.params.id;if(!(!t||!o.value)){f.value=!0,u.value="",c.value="";try{const d={subscription_start:n.subscription_start||null,subscription_end:n.subscription_end||null,is_active:v.value?!1:n.is_active},{data:r}=await V.put("/admin/subscribers/"+t,d);o.value=(r==null?void 0:r.data)??o.value,c.value="Диапазон подписки обновлён."}catch(d){const r=(e=d.response)==null?void 0:e.data;u.value=(r==null?void 0:r.message)??(r!=null&&r.errors?Object.values(r.errors).flat().join(" "):"Ошибка сохранения")}finally{f.value=!1}}}function R(t){return!t||typeof t!="string"?"—":t.length<=12?"••••••••":t.slice(0,8)+"••••••••"+t.slice(-4)}function D(t){return t?new Date(t).toLocaleDateString("ru-RU",{day:"numeric",month:"short",year:"numeric"}):"—"}function S(t){return t?new Date(t).toLocaleString("ru-RU",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}return C(()=>_.params.id,P,{immediate:!0}),C(()=>n.subscription_end,t=>{w(t)&&n.is_active&&(n.is_active=!1)}),(t,e)=>{var r,x;const d=B("router-link");return a(),l("div",A,[s("div",I,[H(d,{to:{name:"admin.subscribers"},class:"inline-flex items-center gap-1 text-sm text-muted-foreground hover:text-foreground mb-2"},{default:F(()=>[...e[3]||(e[3]=[s("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),z(" К списку подписчиков ",-1)])]),_:1}),e[4]||(e[4]=s("h1",{class:"text-2xl font-bold text-foreground"},"Подписчик",-1)),s("p",J,i(((r=o.value)==null?void 0:r.domain)??"—"),1)]),y.value&&!o.value?(a(),l("div",q," Загрузка… ")):m.value?(a(),l("div",G,[s("p",K,i(m.value),1)])):o.value?(a(),l("div",Q,[s("div",W,[e[12]||(e[12]=s("div",{class:"px-4 py-3 border-b border-border bg-muted/30"},[s("h2",{class:"font-semibold text-foreground"},"Основные данные")],-1)),s("dl",X,[s("div",Z,[e[5]||(e[5]=s("dt",{class:"text-sm text-muted-foreground"},"Домен",-1)),s("dd",ee,i(o.value.domain),1)]),s("div",se,[e[6]||(e[6]=s("dt",{class:"text-sm text-muted-foreground"},"Логин",-1)),s("dd",te,i(o.value.login),1)]),s("div",oe,[e[7]||(e[7]=s("dt",{class:"text-sm text-muted-foreground"},"План",-1)),s("dd",re,i(((x=o.value.plan)==null?void 0:x.name)??"—"),1)]),s("div",de,[e[8]||(e[8]=s("dt",{class:"text-sm text-muted-foreground"},"Начало подписки",-1)),s("dd",ne,i(D(o.value.subscription_start)),1)]),s("div",ie,[e[9]||(e[9]=s("dt",{class:"text-sm text-muted-foreground"},"Конец подписки",-1)),s("dd",ae,i(D(o.value.subscription_end)),1)]),s("div",le,[e[10]||(e[10]=s("dt",{class:"text-sm text-muted-foreground"},"Активность",-1)),s("dd",ue,[s("span",{class:O(["inline-flex rounded-full px-2 py-0.5 text-xs font-medium",o.value.is_active?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300":"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300"])},i(o.value.is_active?"Активен":"Неактивен"),3)])]),s("div",ce,[e[11]||(e[11]=s("dt",{class:"text-sm text-muted-foreground"},"API токен",-1)),s("dd",ge,i(R(o.value.api_token)),1)])])]),s("div",pe,[e[17]||(e[17]=s("div",{class:"px-4 py-3 border-b border-border bg-muted/30"},[s("h2",{class:"font-semibold text-foreground"},"Управление диапазоном подписки")],-1)),s("form",{class:"p-6 space-y-4 max-w-xl",onSubmit:$(E,["prevent"])},[s("div",me,[e[13]||(e[13]=s("label",{for:"sub-start",class:"text-sm font-medium text-foreground"},"Начало",-1)),s("div",be,[k(s("input",{id:"sub-start","onUpdate:modelValue":e[0]||(e[0]=b=>n.subscription_start=b),type:"date",class:"w-full rounded-md border border-input bg-background px-3 py-2 text-foreground focus:outline-none focus:ring-2 focus:ring-ring"},null,512),[[T,n.subscription_start]])])]),s("div",fe,[e[14]||(e[14]=s("label",{for:"sub-end",class:"text-sm font-medium text-foreground"},"Конец",-1)),s("div",ve,[k(s("input",{id:"sub-end","onUpdate:modelValue":e[1]||(e[1]=b=>n.subscription_end=b),type:"date",class:"w-full rounded-md border border-input bg-background px-3 py-2 text-foreground focus:outline-none focus:ring-2 focus:ring-ring"},null,512),[[T,n.subscription_end]])])]),s("div",xe,[e[16]||(e[16]=s("span",{class:"text-sm font-medium text-foreground"},"Активен",-1)),s("div",_e,[s("div",ye,[k(s("input",{id:"sub-active","onUpdate:modelValue":e[2]||(e[2]=b=>n.is_active=b),type:"checkbox",class:"rounded border-input disabled:opacity-50 disabled:cursor-not-allowed",disabled:v.value},null,8,he),[[L,n.is_active]]),e[15]||(e[15]=s("label",{for:"sub-active",class:"text-sm text-muted-foreground"},"Подписка активна",-1))]),v.value?(a(),l("p",ke," Подписка не может быть активной: срок действия истёк. ")):g("",!0)])]),s("div",we,[s("button",{type:"submit",class:"rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90 disabled:opacity-50 transition-colors",disabled:f.value||v.value&&n.is_active},i(f.value?"Сохранение…":"Сохранить"),9,De)])],32),u.value||c.value?(a(),l("div",Se,[u.value?(a(),l("p",Ne,i(u.value),1)):g("",!0),c.value?(a(),l("p",Ce,i(c.value),1)):g("",!0)])):g("",!0)]),j.value?(a(),l("div",Te,[e[18]||(e[18]=s("div",{class:"px-4 py-3 border-b border-border bg-muted/30"},[s("h2",{class:"font-semibold text-foreground"},"Данные об оплате")],-1)),s("pre",Ve,i(JSON.stringify(o.value.payment_data,null,2)),1)])):g("",!0),s("div",je,[e[21]||(e[21]=s("div",{class:"px-4 py-3 border-b border-border bg-muted/30"},[s("h2",{class:"font-semibold text-foreground"},"Даты")],-1)),s("dl",Me,[s("div",Pe,[e[19]||(e[19]=s("dt",{class:"text-sm text-muted-foreground"},"Создан",-1)),s("dd",Ee,i(S(o.value.created_at)),1)]),s("div",Re,[e[20]||(e[20]=s("dt",{class:"text-sm text-muted-foreground"},"Обновлён",-1)),s("dd",Ue,i(S(o.value.updated_at)),1)])])])])):g("",!0)])}}};export{Fe as default};
