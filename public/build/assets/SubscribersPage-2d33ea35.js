import{m as U,r as j,o as d,c as i,a as e,g as m,v as F,C as v,F as h,A as k,t as a,f as w,l as b,D as C,x as S,n as M,j as N,k as P,i as B}from"./app-98bb2cad.js";const L={class:"subscribers-page"},R={class:"bg-card rounded-lg border border-border overflow-hidden"},$={class:"p-4 border-b border-border flex flex-wrap gap-3"},z=["value"],A=["disabled"],E={class:"overflow-x-auto"},I={class:"w-full text-sm text-left"},O={class:"divide-y divide-border"},q={key:0,class:"bg-card"},G={key:1,class:"bg-card"},H={class:"px-4 py-3 font-medium text-foreground"},J={class:"px-4 py-3 text-foreground"},K={class:"px-4 py-3 text-foreground"},Q={class:"px-4 py-3 text-muted-foreground"},W={class:"px-4 py-3 text-muted-foreground"},X={class:"px-4 py-3"},Y={class:"px-4 py-3"},Z={key:0,class:"flex flex-wrap items-center justify-between gap-2 border-t border-border px-4 py-3"},ee={class:"text-sm text-muted-foreground"},te={class:"flex gap-2"},oe=["disabled"],se=["disabled"],ae={__name:"SubscribersPage",setup(re){const u=b([]),c=b([]),l=b(!1),s=C({current_page:1,last_page:1,per_page:15,total:0}),n=C({domain:"",plan_id:"",is_active:""});let x=null;function V(){clearTimeout(x),x=setTimeout(()=>{s.current_page=1,p()},300)}function g(){s.current_page=1,p()}async function D(){try{const{data:r}=await S.get("/admin/plans");c.value=(r==null?void 0:r.data)??[]}catch{c.value=[]}}async function p(){l.value=!0;try{const r=new URLSearchParams;r.set("page",String(s.current_page)),r.set("per_page",String(s.per_page)),n.domain&&r.set("domain",n.domain),n.plan_id&&r.set("plan_id",n.plan_id),n.is_active!==""&&r.set("is_active",n.is_active);const{data:t}=await S.get("/admin/subscribers?"+r.toString());u.value=(t==null?void 0:t.data)??[],Object.assign(s,(t==null?void 0:t.meta)??{})}catch{u.value=[]}finally{l.value=!1}}function f(r){s.current_page=r,p()}function _(r){return r?new Date(r).toLocaleDateString("ru-RU",{day:"numeric",month:"short",year:"numeric"}):"—"}return U(()=>{D(),p()}),(r,t)=>{const T=j("router-link");return d(),i("div",L,[t[11]||(t[11]=e("div",{class:"mb-6 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"},[e("div",null,[e("h1",{class:"text-2xl font-bold text-foreground"},"Подписчики"),e("p",{class:"text-muted-foreground mt-1"},"Список подписчиков с пагинацией и фильтрацией")])],-1)),e("div",R,[e("div",$,[m(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>n.domain=o),type:"text",placeholder:"Домен",class:"rounded-md border border-input bg-background px-3 py-2 text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring w-40",onInput:V},null,544),[[F,n.domain]]),m(e("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>n.plan_id=o),class:"rounded-md border border-input bg-background px-3 py-2 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-ring",onChange:g},[t[5]||(t[5]=e("option",{value:""},"Все планы",-1)),(d(!0),i(h,null,k(c.value,o=>(d(),i("option",{key:o.id,value:o.id},a(o.name),9,z))),128))],544),[[v,n.plan_id]]),m(e("select",{"onUpdate:modelValue":t[2]||(t[2]=o=>n.is_active=o),class:"rounded-md border border-input bg-background px-3 py-2 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-ring",onChange:g},[...t[6]||(t[6]=[e("option",{value:""},"Любая активность",-1),e("option",{value:"1"},"Активные",-1),e("option",{value:"0"},"Неактивные",-1)])],544),[[v,n.is_active]]),e("button",{type:"button",class:"rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90 transition-colors",disabled:l.value,onClick:g},a(l.value?"Загрузка…":"Применить"),9,A)]),e("div",E,[e("table",I,[t[10]||(t[10]=e("thead",{class:"bg-muted/50 text-muted-foreground uppercase"},[e("tr",null,[e("th",{class:"px-4 py-3 font-medium"},"Домен"),e("th",{class:"px-4 py-3 font-medium"},"Логин"),e("th",{class:"px-4 py-3 font-medium"},"План"),e("th",{class:"px-4 py-3 font-medium"},"Начало"),e("th",{class:"px-4 py-3 font-medium"},"Конец"),e("th",{class:"px-4 py-3 font-medium"},"Активность"),e("th",{class:"px-4 py-3 font-medium"})])],-1)),e("tbody",O,[l.value&&!u.value.length?(d(),i("tr",q,[...t[7]||(t[7]=[e("td",{colspan:"7",class:"px-4 py-8 text-center text-muted-foreground"},"Загрузка…",-1)])])):u.value.length?w("",!0):(d(),i("tr",G,[...t[8]||(t[8]=[e("td",{colspan:"7",class:"px-4 py-8 text-center text-muted-foreground"},"Нет подписчиков",-1)])])),(d(!0),i(h,null,k(u.value,o=>{var y;return d(),i("tr",{key:o.id,class:"bg-card hover:bg-accent/5 transition-colors"},[e("td",H,a(o.domain),1),e("td",J,a(o.login),1),e("td",K,a(((y=o.plan)==null?void 0:y.name)??"—"),1),e("td",Q,a(_(o.subscription_start)),1),e("td",W,a(_(o.subscription_end)),1),e("td",X,[e("span",{class:M(["inline-flex rounded-full px-2 py-0.5 text-xs font-medium",o.is_active?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300":"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300"])},a(o.is_active?"Активен":"Неактивен"),3)]),e("td",Y,[N(T,{to:{name:"admin.subscriber",params:{id:o.id}},class:"text-primary hover:underline"},{default:P(()=>[...t[9]||(t[9]=[B(" Подробнее ",-1)])]),_:1},8,["to"])])])}),128))])])]),s.last_page>1?(d(),i("div",Z,[e("p",ee," Показано "+a((s.current_page-1)*s.per_page+1)+"–"+a(Math.min(s.current_page*s.per_page,s.total))+" из "+a(s.total),1),e("div",te,[e("button",{type:"button",class:"rounded-md border border-input bg-background px-3 py-1.5 text-sm text-foreground hover:bg-accent/10 disabled:opacity-50 disabled:cursor-not-allowed",disabled:s.current_page<=1||l.value,onClick:t[3]||(t[3]=o=>f(s.current_page-1))}," Назад ",8,oe),e("button",{type:"button",class:"rounded-md border border-input bg-background px-3 py-1.5 text-sm text-foreground hover:bg-accent/10 disabled:opacity-50 disabled:cursor-not-allowed",disabled:s.current_page>=s.last_page||l.value,onClick:t[4]||(t[4]=o=>f(s.current_page+1))}," Вперёд ",8,se)])])):w("",!0)])])}}};export{ae as default};
