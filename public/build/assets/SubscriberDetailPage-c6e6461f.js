import{b as R,e as T,E as U,r as B,o as a,c as l,a as s,j as E,k as F,t as d,n as O,w as P,g as y,v as D,h as $,f as b,l as g,D as L,i as Y,x as S}from"./app-f10ee27e.js";const z={class:"subscriber-detail-page"},A={class:"mb-6"},I={class:"text-muted-foreground mt-1"},J={key:0,class:"bg-card rounded-lg border border-border p-8 text-center text-muted-foreground"},q={key:1,class:"bg-card rounded-lg border border-border p-6"},G={class:"text-red-600 dark:text-red-400"},H={key:2,class:"space-y-6"},K={class:"bg-card rounded-lg border border-border overflow-hidden"},Q={class:"divide-y divide-border"},W={class:"grid grid-cols-1 sm:grid-cols-3 gap-2 px-4 py-3"},X={class:"sm:col-span-2 text-foreground font-medium"},Z={class:"grid grid-cols-1 sm:grid-cols-3 gap-2 px-4 py-3"},ss={class:"sm:col-span-2 text-foreground"},es={class:"grid grid-cols-1 sm:grid-cols-3 gap-2 px-4 py-3"},ts={class:"sm:col-span-2 text-foreground"},os={class:"grid grid-cols-1 sm:grid-cols-3 gap-2 px-4 py-3"},rs={class:"sm:col-span-2 text-foreground"},ds={class:"grid grid-cols-1 sm:grid-cols-3 gap-2 px-4 py-3"},ns={class:"sm:col-span-2 text-foreground"},is={class:"grid grid-cols-1 sm:grid-cols-3 gap-2 px-4 py-3"},as={class:"sm:col-span-2"},ls={class:"grid grid-cols-1 sm:grid-cols-3 gap-2 px-4 py-3"},us={class:"sm:col-span-2 font-mono text-sm text-foreground break-all"},cs={class:"bg-card rounded-lg border border-border overflow-hidden"},gs={class:"grid grid-cols-1 sm:grid-cols-3 gap-2 items-center"},ps={class:"sm:col-span-2"},ms={class:"grid grid-cols-1 sm:grid-cols-3 gap-2 items-center"},bs={class:"sm:col-span-2"},vs={class:"grid grid-cols-1 sm:grid-cols-3 gap-2 items-center"},fs={class:"sm:col-span-2"},xs={class:"flex flex-wrap gap-2 pt-2"},_s=["disabled"],ys={key:0,class:"px-6 pb-4 space-y-1"},hs={key:0,class:"text-sm text-red-600 dark:text-red-400"},ks={key:1,class:"text-sm text-green-600 dark:text-green-400"},ws={key:0,class:"bg-card rounded-lg border border-border overflow-hidden"},Ds={class:"p-4 text-sm text-foreground overflow-x-auto"},Ss={class:"bg-card rounded-lg border border-border overflow-hidden"},Cs={class:"divide-y divide-border"},Ns={class:"grid grid-cols-1 sm:grid-cols-3 gap-2 px-4 py-3"},Vs={class:"sm:col-span-2 text-foreground"},js={class:"grid grid-cols-1 sm:grid-cols-3 gap-2 px-4 py-3"},Ms={class:"sm:col-span-2 text-foreground"},Us={__name:"SubscriberDetailPage",setup(Rs){const x=R(),o=g(null),_=g(!1),p=g(""),v=g(!1),u=g(""),c=g(""),n=L({subscription_start:"",subscription_end:"",is_active:!0}),C=T(()=>{var e;const t=(e=o.value)==null?void 0:e.payment_data;return t&&typeof t=="object"&&Object.keys(t).length>0});function h(t){if(!t)return"";const e=new Date(t);if(isNaN(e.getTime()))return"";const i=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),f=String(e.getDate()).padStart(2,"0");return`${i}-${r}-${f}`}function N(){const t=o.value;t&&(n.subscription_start=h(t.subscription_start),n.subscription_end=h(t.subscription_end),n.is_active=!!t.is_active,u.value="",c.value="")}async function V(){var e,i;const t=x.params.id;if(t){_.value=!0,p.value="";try{const{data:r}=await S.get("/admin/subscribers/"+t);o.value=(r==null?void 0:r.data)??null,o.value?N():p.value="Подписчик не найден"}catch(r){o.value=null,p.value=((i=(e=r.response)==null?void 0:e.data)==null?void 0:i.message)??"Ошибка загрузки"}finally{_.value=!1}}}async function j(){var e;const t=x.params.id;if(!(!t||!o.value)){v.value=!0,u.value="",c.value="";try{const i={subscription_start:n.subscription_start||null,subscription_end:n.subscription_end||null,is_active:n.is_active},{data:r}=await S.put("/admin/subscribers/"+t,i);o.value=(r==null?void 0:r.data)??o.value,c.value="Диапазон подписки обновлён."}catch(i){const r=(e=i.response)==null?void 0:e.data;u.value=(r==null?void 0:r.message)??(r!=null&&r.errors?Object.values(r.errors).flat().join(" "):"Ошибка сохранения")}finally{v.value=!1}}}function M(t){return!t||typeof t!="string"?"—":t.length<=12?"••••••••":t.slice(0,8)+"••••••••"+t.slice(-4)}function k(t){return t?new Date(t).toLocaleDateString("ru-RU",{day:"numeric",month:"short",year:"numeric"}):"—"}function w(t){return t?new Date(t).toLocaleString("ru-RU",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}return U(()=>x.params.id,V,{immediate:!0}),(t,e)=>{var r,f;const i=B("router-link");return a(),l("div",z,[s("div",A,[E(i,{to:{name:"admin.subscribers"},class:"inline-flex items-center gap-1 text-sm text-muted-foreground hover:text-foreground mb-2"},{default:F(()=>[...e[3]||(e[3]=[s("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),Y(" К списку подписчиков ",-1)])]),_:1}),e[4]||(e[4]=s("h1",{class:"text-2xl font-bold text-foreground"},"Подписчик",-1)),s("p",I,d(((r=o.value)==null?void 0:r.domain)??"—"),1)]),_.value&&!o.value?(a(),l("div",J," Загрузка… ")):p.value?(a(),l("div",q,[s("p",G,d(p.value),1)])):o.value?(a(),l("div",H,[s("div",K,[e[12]||(e[12]=s("div",{class:"px-4 py-3 border-b border-border bg-muted/30"},[s("h2",{class:"font-semibold text-foreground"},"Основные данные")],-1)),s("dl",Q,[s("div",W,[e[5]||(e[5]=s("dt",{class:"text-sm text-muted-foreground"},"Домен",-1)),s("dd",X,d(o.value.domain),1)]),s("div",Z,[e[6]||(e[6]=s("dt",{class:"text-sm text-muted-foreground"},"Логин",-1)),s("dd",ss,d(o.value.login),1)]),s("div",es,[e[7]||(e[7]=s("dt",{class:"text-sm text-muted-foreground"},"План",-1)),s("dd",ts,d(((f=o.value.plan)==null?void 0:f.name)??"—"),1)]),s("div",os,[e[8]||(e[8]=s("dt",{class:"text-sm text-muted-foreground"},"Начало подписки",-1)),s("dd",rs,d(k(o.value.subscription_start)),1)]),s("div",ds,[e[9]||(e[9]=s("dt",{class:"text-sm text-muted-foreground"},"Конец подписки",-1)),s("dd",ns,d(k(o.value.subscription_end)),1)]),s("div",is,[e[10]||(e[10]=s("dt",{class:"text-sm text-muted-foreground"},"Активность",-1)),s("dd",as,[s("span",{class:O(["inline-flex rounded-full px-2 py-0.5 text-xs font-medium",o.value.is_active?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300":"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300"])},d(o.value.is_active?"Активен":"Неактивен"),3)])]),s("div",ls,[e[11]||(e[11]=s("dt",{class:"text-sm text-muted-foreground"},"API токен",-1)),s("dd",us,d(M(o.value.api_token)),1)])])]),s("div",cs,[e[17]||(e[17]=s("div",{class:"px-4 py-3 border-b border-border bg-muted/30"},[s("h2",{class:"font-semibold text-foreground"},"Управление диапазоном подписки")],-1)),s("form",{class:"p-6 space-y-4 max-w-xl",onSubmit:P(j,["prevent"])},[s("div",gs,[e[13]||(e[13]=s("label",{for:"sub-start",class:"text-sm font-medium text-foreground"},"Начало",-1)),s("div",ps,[y(s("input",{id:"sub-start","onUpdate:modelValue":e[0]||(e[0]=m=>n.subscription_start=m),type:"date",class:"w-full rounded-md border border-input bg-background px-3 py-2 text-foreground focus:outline-none focus:ring-2 focus:ring-ring"},null,512),[[D,n.subscription_start]])])]),s("div",ms,[e[14]||(e[14]=s("label",{for:"sub-end",class:"text-sm font-medium text-foreground"},"Конец",-1)),s("div",bs,[y(s("input",{id:"sub-end","onUpdate:modelValue":e[1]||(e[1]=m=>n.subscription_end=m),type:"date",class:"w-full rounded-md border border-input bg-background px-3 py-2 text-foreground focus:outline-none focus:ring-2 focus:ring-ring"},null,512),[[D,n.subscription_end]])])]),s("div",vs,[e[16]||(e[16]=s("span",{class:"text-sm font-medium text-foreground"},"Активен",-1)),s("div",fs,[y(s("input",{id:"sub-active","onUpdate:modelValue":e[2]||(e[2]=m=>n.is_active=m),type:"checkbox",class:"rounded border-input"},null,512),[[$,n.is_active]]),e[15]||(e[15]=s("label",{for:"sub-active",class:"ml-2 text-sm text-muted-foreground"},"Подписка активна",-1))])]),s("div",xs,[s("button",{type:"submit",class:"rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90 disabled:opacity-50 transition-colors",disabled:v.value},d(v.value?"Сохранение…":"Сохранить"),9,_s)])],32),u.value||c.value?(a(),l("div",ys,[u.value?(a(),l("p",hs,d(u.value),1)):b("",!0),c.value?(a(),l("p",ks,d(c.value),1)):b("",!0)])):b("",!0)]),C.value?(a(),l("div",ws,[e[18]||(e[18]=s("div",{class:"px-4 py-3 border-b border-border bg-muted/30"},[s("h2",{class:"font-semibold text-foreground"},"Данные об оплате")],-1)),s("pre",Ds,d(JSON.stringify(o.value.payment_data,null,2)),1)])):b("",!0),s("div",Ss,[e[21]||(e[21]=s("div",{class:"px-4 py-3 border-b border-border bg-muted/30"},[s("h2",{class:"font-semibold text-foreground"},"Даты")],-1)),s("dl",Cs,[s("div",Ns,[e[19]||(e[19]=s("dt",{class:"text-sm text-muted-foreground"},"Создан",-1)),s("dd",Vs,d(w(o.value.created_at)),1)]),s("div",js,[e[20]||(e[20]=s("dt",{class:"text-sm text-muted-foreground"},"Обновлён",-1)),s("dd",Ms,d(w(o.value.updated_at)),1)])])])])):b("",!0)])}}};export{Us as default};
