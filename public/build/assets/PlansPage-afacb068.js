import{m as C,r as N,o as a,c as l,a as e,j as b,k as v,f,F as j,A as $,t as d,w as D,l as m,D as B,x as y,i as _,n as F}from"./app-5cd435e6.js";const P={class:"plans-page"},V={class:"mb-6 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"},M={class:"bg-card rounded-lg border border-border overflow-hidden"},S={class:"overflow-x-auto"},z={class:"w-full text-sm text-left"},L={class:"divide-y divide-border"},T={key:0,class:"bg-card"},A={key:1,class:"bg-card"},E={class:"px-4 py-3 font-medium text-foreground"},H={class:"px-4 py-3 text-foreground"},I={class:"px-4 py-3"},J=["title"],O={class:"px-4 py-3"},R={class:"flex flex-wrap gap-2 items-center"},U=["disabled","onClick"],q={key:0,class:"mt-4 rounded-md bg-red-50 dark:bg-red-900/20 p-4"},G={class:"text-sm text-red-600 dark:text-red-400"},K={class:"bg-card rounded-lg border border-border shadow-lg max-w-md w-full mx-4 p-6"},Q={class:"text-muted-foreground text-sm mb-4"},W={class:"flex gap-2 justify-end"},X=["disabled"],te={__name:"PlansPage",setup(Y){const c=m([]),x=m(!1),i=m(""),u=B({}),n=m(null);function p(s){return!s||typeof s!="object"?"":s.description?String(s.description):s.max_users!=null?`max_users: ${s.max_users}`:JSON.stringify(s)}function k(s){return s==null?"—":new Intl.NumberFormat("ru-RU",{style:"decimal",minimumFractionDigits:2}).format(Number(s))}async function g(){var s,t;x.value=!0,i.value="";try{const{data:r}=await y.get("/admin/plans");c.value=(r==null?void 0:r.data)??[]}catch(r){c.value=[],i.value=((t=(s=r.response)==null?void 0:s.data)==null?void 0:t.message)??"Ошибка загрузки"}finally{x.value=!1}}function h(s){n.value=s}async function w(s){var t,r;u[s.id]=!0,i.value="";try{await y.delete(`/admin/plans/${s.id}`),n.value=null,await g()}catch(o){i.value=((r=(t=o.response)==null?void 0:t.data)==null?void 0:r.message)??"Ошибка удаления"}finally{u[s.id]=!1}}return C(()=>{g()}),(s,t)=>{const r=N("router-link");return a(),l("div",P,[e("div",V,[t[4]||(t[4]=e("div",null,[e("h1",{class:"text-2xl font-bold text-foreground"},"Планы"),e("p",{class:"text-muted-foreground mt-1"},"Список тарифных планов")],-1)),b(r,{to:{name:"admin.plans.create"},class:"inline-flex items-center gap-2 rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90 transition-colors"},{default:v(()=>[...t[3]||(t[3]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),_(" Создать план ",-1)])]),_:1})]),e("div",M,[e("div",S,[e("table",z,[t[8]||(t[8]=e("thead",{class:"bg-muted/50 text-muted-foreground uppercase"},[e("tr",null,[e("th",{class:"px-4 py-3 font-medium"},"Название"),e("th",{class:"px-4 py-3 font-medium"},"Стоимость"),e("th",{class:"px-4 py-3 font-medium"},"Активен"),e("th",{class:"px-4 py-3 font-medium"},"Ограничения"),e("th",{class:"px-4 py-3 font-medium"},"Действия")])],-1)),e("tbody",L,[x.value&&!c.value.length?(a(),l("tr",T,[...t[5]||(t[5]=[e("td",{colspan:"5",class:"px-4 py-8 text-center text-muted-foreground"},"Загрузка…",-1)])])):c.value.length?f("",!0):(a(),l("tr",A,[...t[6]||(t[6]=[e("td",{colspan:"5",class:"px-4 py-8 text-center text-muted-foreground"},"Нет планов",-1)])])),(a(!0),l(j,null,$(c.value,o=>(a(),l("tr",{key:o.id,class:"bg-card hover:bg-accent/5 transition-colors"},[e("td",E,d(o.name),1),e("td",H,d(k(o.cost)),1),e("td",I,[e("span",{class:F(["inline-flex rounded-full px-2 py-0.5 text-xs font-medium",o.is_active?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300":"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300"])},d(o.is_active?"Да":"Нет"),3)]),e("td",{class:"px-4 py-3 text-muted-foreground max-w-[200px] truncate",title:p(o.limits)},d(p(o.limits)||"—"),9,J),e("td",O,[e("div",R,[b(r,{to:{name:"admin.plans.edit",params:{id:o.id}},class:"inline-flex items-center rounded-md border border-input bg-background px-3 py-1.5 text-sm font-medium text-foreground hover:bg-accent/10 transition-colors"},{default:v(()=>[...t[7]||(t[7]=[_(" Изменить ",-1)])]),_:1},8,["to"]),e("button",{type:"button",class:"inline-flex items-center rounded-md border border-red-600 dark:border-red-500 px-3 py-1.5 text-sm font-medium text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:u[o.id],onClick:Z=>h(o)},d(u[o.id]?"…":"Удалить"),9,U)])])]))),128))])])])]),i.value?(a(),l("div",q,[e("p",G,d(i.value),1)])):f("",!0),n.value?(a(),l("div",{key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:t[2]||(t[2]=D(o=>n.value=null,["self"]))},[e("div",K,[t[9]||(t[9]=e("h3",{class:"text-lg font-semibold text-foreground mb-2"},"Удалить план?",-1)),e("p",Q," План «"+d(n.value.name)+"» будет удалён. Это действие нельзя отменить. ",1),e("div",W,[e("button",{type:"button",class:"rounded-md border border-input bg-background px-4 py-2 text-sm text-foreground hover:bg-accent/10",onClick:t[0]||(t[0]=o=>n.value=null)}," Отмена "),e("button",{type:"button",class:"rounded-md bg-red-600 px-4 py-2 text-sm font-medium text-white hover:bg-red-700 disabled:opacity-50",disabled:u[n.value.id],onClick:t[1]||(t[1]=o=>w(n.value))},d(u[n.value.id]?"…":"Удалить"),9,X)])])])):f("",!0)])}}};export{te as default};
